# Особенности
Это реализация сервиса по регистрации посылок.
Он включает в себя добавление новых типов посылок через data.csv без удаления или перезаписи старых типов
Реализована фильтрация доступных пользователю посылок через сохранение записи о сессии пользотеля по средствам cookie хранящихся браузера.

# TODO
- Шифрование cookie для большей безопасности данных
- Добавление unit-test-ов, хотя бы для API (partialy)
- добавление celery для вызова периодических тасок
- Система подсчёта данных посылок за день с использованием MongoDB
    ```
    Предположим, у нас в день бывает миллион посылок. Есть техническое условие - хранить лог расчётов стоимостей доставок в MongoDB. Предложите и реализуйте способ подсчета суммы стоимостей доставок всех посылок по типам за день, используя информацию из этого лога.
    ```
    1. Добавить хранение расчётов в MongoDB
    2. Добавить апи для того, чтобы вытащить всё расчёты за день. Они должны быть сгрупированны по типам и в каждой группе должна быть своя сумма данных
- Добавление Grafana для хранение всех логов
- Брокер на RabbitMQ для регистрации всех посылок по POST /package
    ```
    Реализовать регистрацию посылок используя RabbitMQ. Посылки из роута регистрации попадают не напрямую в БД, а через брокер сообщений и воркеры, которые попутно сразу же рассчитают стоимость доставки. Периодическая задача расчета стоимость доставки больше не нужна.
    ```
- Создать систему и роут для привязки транспортной компании к посылке. PUT /package/{package_id}/set-company
    ```
    Создать роут привязки посылки к транспортной компании (добавить id компании - любое положительное число - к записи посылки), которая ее будет доставлять. Одну посылку могут попытаться привязать разные компании, поэтому необходимо обеспечить гарантию, что 1-й обратившаяся компания закрепит посылку за собой. У нас высоконагруженная система - запросы могут прилетать несколько раз в секунду.
    ```

# Установка

Для начальной установки будет достаточно зайти в корень папки с docker-compose.yml и набрать `docker-compose up --build`
Все необходимые настройки для базы данных, контейнеров для FastAPI и приложений будут автоматически включены при первой сборке docker-compose

# Подключение

Для подключения и использования приложения достаточно пройтий по http://0.0.0.0:8000/docs#/
Swagger работает с cookie в этом приложении, что поддерживает не каждая реализация сессий и cookie


# Прочее

Для теста используется стандартная библиотека unittest. Официальная документация к FastAPI предполагает использование testpy для юнит-тестов, но в качестве эксперемента здесь используется unittest. (Он мне больше нравится).
Для тестового окружения используются MySQL, что используются в продакшене, но используют другие базы данные с припиской test.
Пришлось откатиться на версию httpx==0.27.1, из-за странного бага, не позволяющего передать app в AsyncClient

